<style>
  #chart {
  min-width: 400px;
  .apexcharts-tooltip {
    box-shadow: 1px 4px 6px 0 rgba(15, 15, 15, 0.5);
    border: none;
    border-radius: 3px;
  }
}
.chart-tooltip {
  padding: 5px;
  p {
    font-family: 'Lato';
    font-size: 13px;
    margin-top: 0;
    &:not(:last-child) {
      margin-bottom: 4px;
    }
    &:last-child {
      margin-bottom: 0;
    }
  }
}
</style>
<script>
  // powered by ApexCharts: https://apexcharts.com/
const randomInRange = (max, min) => Math.floor(Math.random() * (max - min + 1)) + min;
const roundToDecimals = (input, precision) => Number(input.toFixed(precision));
const toFourDecimals = (input) => roundToDecimals(input, 4);
const numberOfDaysOnChart = window.innerWidth / 15;
const maxCloseDeviation = 0.125; // max change between open and close
const maxIntradayDeviation = 0.15; // max deviation between top/bottom of candle and top/bottom of wick
const maxPremarketDeviation = 0.05;

const getRandomDate = () => {
  const monthsWith30Days = [4, 6, 9, 11];
  const fullDate = {};
  const month = randomInRange(11, 0);
  const getDay = () => {
    if (month === 2) { // february
      return randomInRange(28, 1);
    } else if (monthsWith30Days.includes(month)) { // april, june, september, november
      return randomInRange(30, 1);
    }
    // any other month
    return randomInRange(31, 1);  
  };
  const day = getDay();
  let year = randomInRange(new Date().getFullYear(), 1970);
  fullDate.month = month;
  fullDate.day = day;
  fullDate.year = year;
  return fullDate;
};

const getRandomPriceAction = (openPrice) => {
  const open = openPrice;
  const closeMax = openPrice * (1 + maxCloseDeviation);
  const closeMin = openPrice * (1 - maxCloseDeviation);
  const close = toFourDecimals(randomInRange(closeMax, closeMin));
  const higherPrice = Math.max(open, close);
  const lowerPrice = Math.min(open, close);
  const intraMax = higherPrice * (1 + maxIntradayDeviation);
  const intraLow = lowerPrice * (1 - maxIntradayDeviation);
  const high = toFourDecimals(randomInRange(intraMax, higherPrice));
  const low = toFourDecimals(randomInRange(intraLow, lowerPrice));
  
  return [open, high, low, close]; // format required by ApexCharts for candlestick charts
};

const getOpeningPrice = (basePrice) => {
  const pMax = basePrice * (1 + maxPremarketDeviation);
  const pMin = basePrice * (1 - maxPremarketDeviation);
  return randomInRange(pMax, pMin);
};

const generateRandomData = () => {
  const initialPrice = randomInRange(2000, 1);
  const dates = [];
  const prices = [];
  
  const firstDayPrice = getRandomPriceAction(initialPrice);
  prices.push(firstDayPrice);
  
  const firstDayDate = getRandomDate();
  const firstDayJSDate = new Date(firstDayDate.year, firstDayDate.month, firstDayDate.day);
  dates.push(firstDayJSDate);
  
  for (let i = 0, l = numberOfDaysOnChart; i < l; i += 1) {
    const lastPrice = prices[i][3]; // closing price
    const openingPrice = getOpeningPrice(lastPrice);
    const newPriceAction = getRandomPriceAction(openingPrice);
    prices.push(newPriceAction);
    
    const lastDate = dates[i];
    const nextDay = lastDate.setDate(lastDate.getDate() + 1);
    const nextDayJSDate = new Date(nextDay);

    dates.push(nextDayJSDate);
  }
  
  const data = [];
  for (let i = 0, l = numberOfDaysOnChart; i < l; i += 1) {
    data.push({ // one possible format accepted by ApexCharts for rendering candlestick charts
      x: dates[i],
      y: prices[i],
    });
  }
  
  return data;
};

const options = {
  series: [{
    name: 'candle',
    type: 'candlestick',
    data: generateRandomData(),
  }],
  chart: {
    height: Math.max(window.innerHeight * 0.8, 300),
    type: 'line',
    fontFamily: 'Lato',
    offsetY: 20,
  },
  title: {
    text: 'Definitely Real Company (REAL)',
    align: 'left',
    style: {
      fontSize: '18px',
      fontWeight: 'bold',
    },
  },
  stroke: {
    width: [2, 0]
  },
  tooltip: {
    enabled: true,
    custom: function({ seriesIndex, dataPointIndex, w }) {
      let open = w.globals.seriesCandleO[seriesIndex][dataPointIndex].toFixed(2);
      let high = w.globals.seriesCandleH[seriesIndex][dataPointIndex].toFixed(2);
      let low = w.globals.seriesCandleL[seriesIndex][dataPointIndex].toFixed(2);
      let close = w.globals.seriesCandleC[seriesIndex][dataPointIndex].toFixed(2);
      return (
        '<div class="chart-tooltip">' +
        `<p><strong>Open:</strong> ${open}</p>` +
        `<p><strong>High:</strong> ${high}</p>` +
        `<p><strong>Low:</strong> ${low}</p>` +
        `<p><strong>Close:</strong> ${close}` +
        '</div>'
      )
    },
    onDatasetHover: {
      highlightDataSeries: true,
    },
  },
  xaxis: {
    type: 'datetime'
  },
  yaxis: {
    labels: {
      formatter: (val) => val.toFixed(2),
    },
    tooltip: {
      enabled: true,
    },
    crosshairs: {
      stroke: {
        width: 1,
        dashArray: 3,
      },
    },
  },
  plotOptions: {
    candlestick: {
      colors: {
        upward: '#27AE60',
        downward: '#CB4335',
      },
      wick: {
        useFillColor: true,
      },
    },
  },
};

const chart = new ApexCharts(document.getElementById('chart'), options);
chart.render();

</script>
